<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YorName</title>

<style>
*{box-sizing:border-box;margin:0;padding:0}

body{
font-family:-apple-system,BlinkMacSystemFont,sans-serif;
background:#f2f2f2;
display:flex;
justify-content:center;
padding:40px 10px;
}

.app{
width:100%;
max-width:430px;
background:#0b0b0b;
color:white;
border-radius:30px;
overflow:hidden;
box-shadow:0 40px 120px rgba(0,0,0,.35);
}

/* HERO */
.hero{
height:280px;
background:url("https://avatars.yandex.net/get-music-content/16464214/8bceb93a.p.24009925/m1000x1000") center/cover;
display:flex;
align-items:flex-end;
padding:20px;
position:relative;
}

.hero::after{
content:"";
position:absolute;
inset:0;
background:linear-gradient(to top,rgba(0,0,0,.85),transparent);
}

.hero-content{
position:relative;
z-index:2;
}

.hero h1{font-size:22px}
.hero p{font-size:13px;opacity:.7;margin-top:6px}

.section{
padding:20px;
}

.section:hover .beat{opacity:.35}
.section .beat:hover{opacity:1}

/* BEAT */
.beat{
margin-bottom:28px;
transition:.25s;
}

.beat-title{font-size:15px}
.beat-type{
font-size:12px;
opacity:.6;
margin:6px 0 10px;
}

/* PLAYER */
.player{
display:flex;
gap:10px;
align-items:center;
}

.play{
width:38px;height:38px;
border-radius:50%;
border:none;
background:rgba(255,255,255,.12);
color:white;
cursor:pointer;
}

.play.active{
box-shadow:0 0 14px rgba(255,255,255,.7);
}

.wave{
flex:1;
height:6px;
background:rgba(255,255,255,.2);
border-radius:4px;
cursor:pointer;
position:relative;
}

.progress{
height:100%;
width:0%;
background:white;
border-radius:4px;
}

.bottom{
display:flex;
justify-content:space-between;
align-items:center;
margin-top:12px;
font-size:12px;
}

.buy{
padding:6px 12px;
border-radius:14px;
background:rgba(255,255,255,.12);
border:1px solid rgba(255,255,255,.25);
color:white;
text-decoration:none;
}
</style>
</head>

<body>

<div class="app">

<div class="hero">
<div class="hero-content">
<h1>YorName ✔</h1>
<p>Немного о тебе / credits</p>
</div>
</div>

<div class="section" id="beats"></div>

</div>

<script>

/* ================= CONFIG ================= */

const CSV_URL =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vRaW-Jeexk1nvmxlUTk7TAq2akhZW8eY7OxYkgbNcDFyfcOqfyq17_L4w3xRW8cz14JWME0_Fk29hWs/pub?output=csv";

const tgUsername="username";

/* ========================================== */

let currentAudio=null;

/* НАДЁЖНЫЙ CSV PARSER */
function parseCSV(text){

return text
.replace(/\r/g,"")
.split("\n")
.slice(1)
.map(line=>{
const cols=line.split(",");
if(cols.length<6) return null;

return{
title:cols[0],
type:cols[1],
mp3:cols[2],
wav:cols[3],
exclusive:cols[4],
file:cols[5]
};
})
.filter(Boolean);
}

/* РЕНДЕР */
function render(beats){

const container=document.getElementById("beats");

beats.forEach(b=>{

const beat=document.createElement("div");
beat.className="beat";

beat.innerHTML=`
<div class="beat-title">${b.title}</div>
<div class="beat-type">${b.type}</div>

<div class="player">
<button class="play">▶</button>
<div class="wave"><div class="progress"></div></div>
</div>

<div class="bottom">
<div>MP3 ${b.mp3}₽ | WAV ${b.wav}₽ | EXCL ${b.exclusive}₽</div>
<a class="buy"
href="https://t.me/${tgUsername}?text=Хочу купить ${encodeURIComponent(b.title)}">
Купить
</a>
</div>

<audio preload="metadata" src="${b.file}"></audio>
`;

container.appendChild(beat);

const audio=beat.querySelector("audio");
const btn=beat.querySelector(".play");
const wave=beat.querySelector(".wave");
const progress=beat.querySelector(".progress");

btn.onclick=()=>{

if(currentAudio && currentAudio!==audio){
currentAudio.pause();
currentAudio.parentElement.querySelector(".play").textContent="▶";
currentAudio.parentElement.querySelector(".play").classList.remove("active");
}

if(audio.paused){
audio.play();
btn.textContent="⏸";
btn.classList.add("active");
currentAudio=audio;
}else{
audio.pause();
btn.textContent="▶";
btn.classList.remove("active");
}
};

audio.addEventListener("timeupdate",()=>{
if(audio.duration){
progress.style.width=(audio.currentTime/audio.duration)*100+"%";
}
});

wave.addEventListener("click",(e)=>{
if(!audio.duration) return;
const rect=wave.getBoundingClientRect();
audio.currentTime=((e.clientX-rect.left)/rect.width)*audio.duration;
});

});
}

/* ЗАГРУЗКА */
fetch(CSV_URL)
.then(r=>r.text())
.then(text=>render(parseCSV(text)));

</script>

</body>
</html>
