<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Beat Page</title>

<style>

*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif}

body{
background:#0b0b0b;
min-height:100vh;
display:flex;
justify-content:center;
align-items:center;
color:#fff;
}

/* BACKGROUND */

.bg{
position:fixed;
inset:0;
background-size:cover;
background-position:center;
filter:blur(70px) brightness(.6);
transform:scale(1.2);
z-index:-2;
transition:filter .4s ease;
}

/* APP */

.app{
width:420px;
max-width:95%;
border-radius:28px;
overflow:hidden;
background:rgba(20,20,20,.55);
backdrop-filter:blur(30px);
box-shadow:
0 20px 80px rgba(0,0,0,.6),
inset 0 1px rgba(255,255,255,.15);
}

/* HERO */

.hero{
height:240px;
background-size:cover;
background-position:center;
display:flex;
align-items:flex-end;
padding:20px;
position:relative;
}

.hero::after{
content:"";
position:absolute;
inset:0;
background:linear-gradient(to top,rgba(0,0,0,.85),transparent 60%);
}

.hero-text{position:relative;z-index:2;}

.hero h1{font-size:24px;font-weight:700}
.hero p{opacity:.85;margin-top:6px}

/* SOCIAL */

.social{
display:flex;
gap:10px;
flex-wrap:wrap;
padding:16px;
}

.social a{
text-decoration:none;
color:#fff;
padding:8px 14px;
border-radius:14px;
background:rgba(255,255,255,.08);
}

/* BEATS */

.beats{
padding:10px 14px 20px;
display:flex;
flex-direction:column;
gap:14px;
}

.beat{
padding:14px;
border-radius:18px;
background:rgba(255,255,255,.06);
transition:.35s;
position:relative;
overflow:hidden;
}

/* GLASS LIGHT */

.beat::before{
content:"";
position:absolute;
inset:-40%;
background:linear-gradient(120deg,transparent 40%,rgba(255,255,255,.15),transparent 60%);
opacity:0;
transition:.6s;
transform:translateX(-60%);
pointer-events:none;
}

.beat:hover::before{
opacity:1;
transform:translateX(60%);
}

/* HOVER SYSTEM */

.beats .beat:hover{
transform:scale(1.02);
z-index:2;
}

.beats .beat:hover ~ .beat,
.beats .beat:has(~ .beat:hover){
opacity:.35;
filter:blur(2px);
}

/* ACTIVE */

.beat.active{
box-shadow:
0 0 25px rgba(255,255,255,.08),
0 0 60px rgba(255,255,255,.05);
}

/* PLAYER */

.player{
display:flex;
align-items:center;
gap:10px;
margin-top:10px;
}

.play{
width:36px;
height:36px;
border-radius:50%;
border:none;
background:rgba(255,255,255,.15);
color:#fff;
cursor:pointer;
}

.progress{
flex:1;
height:4px;
background:#444;
border-radius:10px;
cursor:pointer;
}

.bar{
height:100%;
width:0%;
background:#fff;
border-radius:10px;
}

/* PRICE */

.bottom{
display:flex;
justify-content:space-between;
align-items:center;
margin-top:10px;
}

.price{
font-size:11px;
opacity:.85;
}

.actions{
display:flex;
gap:8px;
}

.download{
border:none;
padding:6px 14px;
border-radius:12px;
background:rgba(255,255,255,.12);
color:#fff;
cursor:pointer;
}

.buy{
border:none;
padding:6px 14px;
border-radius:12px;
background:rgba(255,60,60,.25);
color:#fff;
cursor:pointer;
box-shadow:0 0 12px rgba(255,60,60,.25);
}

/* FOOTER */

.footer{
text-align:center;
padding:16px;
font-size:12px;
opacity:.6;
}

.footer a{color:#fff;text-decoration:none;}

</style>
</head>

<body>

<div class="bg" id="bg"></div>

<div class="app">

<div class="hero" id="hero">
<div class="hero-text">
<h1 id="name">Loading...</h1>
<p id="desc"></p>
</div>
</div>

<div class="social" id="social"></div>
<div class="beats" id="beats"></div>

<div class="footer">
<a href="https://t.me/imbulavin" target="_blank">
© <span id="year"></span> BULAVIN. All rights reserved.
</a>
</div>

</div>

<script>

const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vRaW-Jeexk1nvmxlUTk7TAq2akhZW8eY7OxYkgbNcDFyfcOqfyq17_L4w3xRW8cz14JWME0_Fk29hWs/pub?output=csv";

/* CSV PARSER */

function parseCSV(text){
const rows=[];
let row=[],cell="",quotes=false;

for(let c of text){
if(c=='"'){quotes=!quotes;continue;}
if(c==','&&!quotes){row.push(cell);cell="";continue;}
if((c=='\n'||c=='\r')&&!quotes){
if(cell||row.length){row.push(cell);rows.push(row);row=[];cell="";}
continue;
}
cell+=c;
}
if(cell)row.push(cell);
if(row.length)rows.push(row);
return rows;
}

/* DOM */

const nameEl=document.getElementById("name");
const descEl=document.getElementById("desc");
const heroEl=document.getElementById("hero");
const bgEl=document.getElementById("bg");
const socialEl=document.getElementById("social");
const beatsEl=document.getElementById("beats");
document.getElementById("year").textContent=new Date().getFullYear();

/* AUDIO ENGINE */

let currentAudio=null;
let currentBtn=null;
let currentCard=null;

fetch(CSV_URL)
.then(r=>r.text())
.then(text=>{

const rows=parseCSV(text);
const p=rows[1];

/* PROFILE */

nameEl.textContent=p[0];
descEl.textContent=p[1];
heroEl.style.backgroundImage=`url(${p[2]})`;
bgEl.style.backgroundImage=`url(${p[2]})`;

/* SOCIALS */

[
["Telegram",p[3]],
["Instagram",p[4]],
["YouTube",p[5]],
["VK",p[6]]
].forEach(([label,link])=>{
if(!link)return;
const a=document.createElement("a");
a.href=link;
a.target="_blank";
a.textContent=label;
socialEl.appendChild(a);
});

/* BEATS */

rows.slice(4).reverse().forEach(r=>{

if(!r[0])return;

const beat=document.createElement("div");
beat.className="beat";

beat.innerHTML=`
<b>${r[0]}</b>
<div style="opacity:.7;font-size:13px">${r[1]}</div>

<div class="player">
<button class="play">▶</button>
<div class="progress"><div class="bar"></div></div>
</div>

<div class="bottom">
<div class="price">
MP3 ${r[2]}₽ | WAV ${r[3]}₽ | EXCL ${r[4]}₽
</div>
<div class="actions">
<button class="download">Скачать</button>
<button class="buy">Купить</button>
</div>
</div>
`;

const audio=new Audio(r[5]);
const playBtn=beat.querySelector(".play");
const bar=beat.querySelector(".bar");
const progress=beat.querySelector(".progress");

/* PLAY SYSTEM */

playBtn.onclick=()=>{

if(currentAudio && currentAudio!==audio){
currentAudio.pause();
currentBtn.textContent="▶";
currentCard.classList.remove("active");
}

if(audio.paused){

audio.play();
playBtn.textContent="❚❚";
beat.classList.add("active");

bgEl.style.filter="blur(80px) brightness(.75)";

currentAudio=audio;
currentBtn=playBtn;
currentCard=beat;

}else{

audio.pause();
playBtn.textContent="▶";
beat.classList.remove("active");

bgEl.style.filter="blur(70px) brightness(.6)";

currentAudio=null;
}
};

audio.ontimeupdate=()=>{
if(audio.duration)
bar.style.width=(audio.currentTime/audio.duration*100)+"%";
};

progress.onclick=e=>{
const rect=progress.getBoundingClientRect();
audio.currentTime=((e.clientX-rect.left)/rect.width)*audio.duration;
};

beat.querySelector(".buy").onclick=()=>window.open(p[7],"_blank");

beat.querySelector(".download").onclick=()=>{
const a=document.createElement("a");
a.href=r[5];
a.download="";
a.click();
};

beatsEl.appendChild(beat);

});

});

</script>
</body>
</html>
