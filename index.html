<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Beat Page</title>

<style>

*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif}

body{
background:#0b0b0c;
color:#fff;
min-height:100vh;
display:flex;
justify-content:center;
}

/* BACKGROUND */

.bg{
position:fixed;
inset:0;
background-size:cover;
background-position:center;
filter:blur(70px) brightness(.6);
transform:scale(1.2);
z-index:-1;
}

/* CONTAINER */

.container{
width:100%;
max-width:720px;
padding:20px 16px 40px;
}

/* GLASS */

.glass{
background:rgba(255,255,255,.06);
backdrop-filter:blur(26px);
border:1px solid rgba(255,255,255,.08);
border-radius:24px;
box-shadow:
0 20px 60px rgba(0,0,0,.6),
inset 0 1px rgba(255,255,255,.08);
}

/* HERO */

.hero{
overflow:hidden;
position:relative;
margin-bottom:18px;
}

.hero-img{
height:320px;
background-size:cover;
background-position:center;
}

.hero-overlay{
position:absolute;
bottom:0;
left:0;
right:0;
padding:26px;
background:linear-gradient(to top,rgba(0,0,0,.85),transparent);
}

.hero h1{font-size:30px}
.hero p{opacity:.8;margin-top:4px}

/* SOCIAL */

.socials{
display:flex;
flex-wrap:wrap;
gap:10px;
margin-bottom:18px;
}

.socials a{
text-decoration:none;
color:white;
padding:10px 18px;
border-radius:14px;
background:rgba(255,255,255,.08);
transition:.25s;
}

.socials a:hover{
background:rgba(255,255,255,.18);
}

/* BEATS */

.list{
display:flex;
flex-direction:column;
gap:14px;
}

.beat{
padding:18px;
transition:.35s;
}

.list:hover .beat:not(:hover){
opacity:.35;
filter:blur(3px);
}

.beat:hover{
transform:scale(1.02);
}

/* PLAYER */

.player{
display:flex;
align-items:center;
gap:12px;
margin:10px 0;
}

.play{
width:38px;
height:38px;
border-radius:50%;
border:none;
background:rgba(255,255,255,.15);
color:#fff;
cursor:pointer;
}

.progress{
flex:1;
height:4px;
background:#444;
border-radius:10px;
cursor:pointer;
}

.bar{
height:100%;
width:0%;
background:#fff;
border-radius:10px;
}

/* BOTTOM */

.bottom{
display:flex;
justify-content:space-between;
align-items:center;
margin-top:10px;
}

.price{font-size:14px;opacity:.85}

.buy{
padding:8px 16px;
border-radius:14px;
border:none;
background:white;
color:black;
cursor:pointer;
}

/* FOOTER */

.footer{
text-align:center;
opacity:.5;
margin-top:20px;
font-size:12px;
}

.loading{
text-align:center;
opacity:.6;
padding:40px;
}

</style>
</head>

<body>

<div class="bg" id="bg"></div>

<div class="container">
<div id="app" class="loading">Loading...</div>
</div>

<script>

const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vRaW-Jeexk1nvmxlUTk7TAq2akhZW8eY7OxYkgbNcDFyfcOqfyq17_L4w3xRW8cz14JWME0_Fk29hWs/pub?output=csv";

let currentAudio=null;

function parseCSV(text){
return text.trim().split("\n").map(r=>r.split(","));
}

fetch(CSV_URL)
.then(r=>r.text())
.then(text=>{

const rows=parseCSV(text);

/* PROFILE */
const p=rows[1];

const name=p[0];
const desc=p[1];
const photo=p[2];
const tg=p[3];
const ig=p[4];
const yt=p[5];
const vk=p[6];
const buyLink=p[7];

document.getElementById("bg").style.backgroundImage=`url(${photo})`;

let html=`
<div class="hero glass">
<div class="hero-img" style="background-image:url('${photo}')"></div>
<div class="hero-overlay">
<h1>${name}</h1>
<p>${desc}</p>
</div>
</div>

<div class="socials">
${tg?`<a href="${tg}" target="_blank">Telegram</a>`:""}
${ig?`<a href="${ig}" target="_blank">Instagram</a>`:""}
${yt?`<a href="${yt}" target="_blank">YouTube</a>`:""}
${vk?`<a href="${vk}" target="_blank">VK</a>`:""}
</div>

<div class="list">
`;

for(let i=4;i<rows.length;i++){

let r=rows[i];
if(!r[0]) continue;

html+=`
<div class="beat glass">

<b>${r[0]}</b>
<div style="opacity:.6;font-size:14px">${r[1]}</div>

<div class="player">
<button class="play">▶</button>
<div class="progress"><div class="bar"></div></div>
</div>

<div class="bottom">
<div class="price">
MP3 ${r[2]}₽ | WAV ${r[3]}₽ | EXCL ${r[4]}₽
</div>
<button class="buy">Купить</button>
</div>

<audio src="${r[5]}"></audio>

</div>
`;
}

html+=`</div><div class="footer">Made by BULAVIN</div>`;

document.getElementById("app").innerHTML=html;

/* PLAYER */

document.querySelectorAll(".beat").forEach(card=>{

const audio=card.querySelector("audio");
const play=card.querySelector(".play");
const bar=card.querySelector(".bar");
const progress=card.querySelector(".progress");

play.onclick=()=>{

if(currentAudio && currentAudio!==audio){
currentAudio.pause();
currentAudio.parentElement.querySelector(".play").textContent="▶";
}

if(audio.paused){
audio.play();
play.textContent="❚❚";
currentAudio=audio;
}else{
audio.pause();
play.textContent="▶";
}
};

audio.ontimeupdate=()=>{
bar.style.width=(audio.currentTime/audio.duration*100)+"%";
};

progress.onclick=e=>{
const rect=progress.getBoundingClientRect();
audio.currentTime=((e.clientX-rect.left)/rect.width)*audio.duration;
};

card.querySelector(".buy").onclick=()=>{
window.open(buyLink,"_blank");
};

});

})
.catch(()=>{
document.getElementById("app").innerHTML="Ошибка загрузки CSV";
});

</script>
</body>
</html>
