<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Beat Page</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif}

body{
background:#0b0b0b;
color:#fff;
display:flex;
justify-content:center;
padding:40px 12px;
}

.bg{
position:fixed;inset:0;
background-size:cover;
background-position:center;
filter:blur(60px) brightness(.55);
transform:scale(1.2);
transition:1s;
z-index:-1;
}
.bg.playing{
transform:scale(1.28);
filter:blur(70px) brightness(.65);
}

.app{
width:520px;
max-width:100%;
border-radius:28px;
overflow:hidden;
background:rgba(20,20,20,.55);
backdrop-filter:blur(30px);
box-shadow:0 25px 90px rgba(0,0,0,.7);
}

.hero{
height:260px;
background-size:cover;
background-position:center;
display:flex;
align-items:flex-end;
padding:22px;
position:relative;
}
.hero:after{
content:"";
position:absolute;inset:0;
background:linear-gradient(to top,rgba(0,0,0,.85),transparent);
}
.hero-text{position:relative;z-index:2}

.social{
display:flex;
gap:10px;
overflow-x:auto;
padding:16px;
}
.social a{
white-space:nowrap;
padding:8px 16px;
border-radius:14px;
background:rgba(255,255,255,.08);
color:#fff;text-decoration:none;
}

.beats{
padding:10px 16px 24px;
display:flex;
flex-direction:column;
gap:14px;
}

.beat{
padding:16px;
border-radius:18px;
background:rgba(255,255,255,.06);
backdrop-filter:blur(25px);
transition:.35s;
position:relative;
overflow:hidden;
}

.beat::before{
content:"";
position:absolute;inset:0;
background:linear-gradient(120deg,transparent 30%,rgba(255,255,255,.18),transparent 70%);
opacity:0;
transition:.4s;
pointer-events:none;
}
.beat:hover::before{opacity:1}

.beats:hover .beat{opacity:.35;filter:blur(2px)}
.beats:hover .beat:hover{
opacity:1;filter:none;
transform:translateY(-3px) scale(1.02);
}

.title{font-weight:600;display:flex;flex-wrap:wrap;gap:6px}
.meta{font-size:13px;color:#ff8c8c;opacity:.8}
.artist{font-size:14px;opacity:.7;margin-top:2px}

.player{display:flex;gap:10px;margin-top:10px;align-items:center}

.play{
width:36px;height:36px;border-radius:50%;
border:none;background:rgba(255,255,255,.15);
color:#fff;cursor:pointer;
}

.progress{flex:1;height:4px;background:#444;border-radius:10px;cursor:pointer}
.bar{height:100%;width:0;background:#fff;border-radius:10px}

.bottom{
display:flex;
justify-content:space-between;
align-items:center;
margin-top:10px;
flex-wrap:wrap;
}

.price{font-size:12px;opacity:.85}

.actions{display:flex;gap:8px;margin-left:auto}

.download{
border:none;padding:6px 12px;border-radius:12px;
background:rgba(255,255,255,.12);color:#fff;cursor:pointer;
}
.buy{
border:none;padding:6px 14px;border-radius:12px;
background:rgba(255,80,80,.9);color:#fff;cursor:pointer;
}

.footer{
text-align:center;
padding:16px;
font-size:12px;
opacity:.6;
}
.footer a{color:#fff;text-decoration:none}
</style>
</head>

<body>

<div class="bg" id="bg"></div>

<div class="app">

<div class="hero" id="hero">
<div class="hero-text">
<h1 id="name">Loading...</h1>
<p id="desc"></p>
</div>
</div>

<div class="social" id="social"></div>
<div class="beats" id="beats"></div>

<div class="footer">
© <a href="https://t.me/imbulavin" target="_blank">BULAVIN</a>
</div>

</div>

<script>

const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vRaW-Jeexk1nvmxlUTk7TAq2akhZW8eY7OxYkgbNcDFyfcOqfyq17_L4w3xRW8cz14JWME0_Fk29hWs/pub?output=csv";

/* ✅ REAL CSV PARSER (НЕ ЛОМАЕТСЯ) */
function parseCSV(text){
const rows=[];
let row=[],cell="",inside=false;

for(let c of text){
if(c=='"'){inside=!inside;continue;}
if(c==","&&!inside){row.push(cell);cell="";continue;}
if(c=="\n"&&!inside){row.push(cell);rows.push(row);row=[];cell="";continue;}
cell+=c;
}
row.push(cell);
rows.push(row);
return rows;
}

let currentAudio=null;
let defaultBg="";

fetch(CSV_URL)
.then(r=>r.text())
.then(text=>{

text=text.replace(/^\uFEFF/,"");

const rows=parseCSV(text);

const p=rows[1]||[];

name.textContent=p[0]||"YourName";
desc.textContent=p[1]||"";

hero.style.backgroundImage=`url(${p[2]})`;
bg.style.backgroundImage=`url(${p[2]})`;
defaultBg=p[2];

[
["Telegram",p[3]],
["Instagram",p[4]],
["YouTube",p[5]],
["VK",p[6]]
].forEach(s=>{
if(!s[1])return;
const a=document.createElement("a");
a.href=s[1];
a.target="_blank";
a.textContent=s[0];
social.appendChild(a);
});

const buyLink=p[7];

rows.slice(4).forEach(r=>{
if(!r[0])return;

const beat=document.createElement("div");
beat.className="beat";

beat.innerHTML=`
<div class="title">
${r[0]}
<span class="meta">| ${r[2]} BPM | ${r[3]}</span>
</div>

<div class="artist">${r[1]||""}</div>

<div class="player">
<button class="play">▶</button>
<div class="progress"><div class="bar"></div></div>
</div>

<div class="bottom">
<div class="price">
MP3 ${r[4]}₽ | WAV ${r[5]}₽ | EXCL ${r[6]}₽
</div>

<div class="actions">
<button class="download">Скачать</button>
<button class="buy">Купить</button>
</div>
</div>
`;

const audio=new Audio(r[7]);

const playBtn=beat.querySelector(".play");
const bar=beat.querySelector(".bar");
const progress=beat.querySelector(".progress");

playBtn.onclick=()=>{
if(currentAudio && currentAudio!==audio){
currentAudio.pause();
currentAudio.btn.textContent="▶";
bg.style.backgroundImage=`url(${defaultBg})`;
}

if(audio.paused){
audio.play();
playBtn.textContent="❚❚";
currentAudio=audio;
audio.btn=playBtn;
bg.classList.add("playing");
}else{
audio.pause();
playBtn.textContent="▶";
bg.classList.remove("playing");
bg.style.backgroundImage=`url(${defaultBg})`;
}
};

audio.onended=()=>{
playBtn.textContent="▶";
bg.classList.remove("playing");
bg.style.backgroundImage=`url(${defaultBg})`;
};

audio.ontimeupdate=()=>{
bar.style.width=(audio.currentTime/audio.duration*100)+"%";
};

progress.onclick=e=>{
const rect=progress.getBoundingClientRect();
audio.currentTime=((e.clientX-rect.left)/rect.width)*audio.duration;
};

beat.querySelector(".buy").onclick=()=>window.open(buyLink,"_blank");
beat.querySelector(".download").onclick=()=>window.open(r[7],"_blank");

beats.appendChild(beat);
});

});

</script>

</body>
</html>
