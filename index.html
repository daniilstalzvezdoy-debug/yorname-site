<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Premium Beat Store</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif}
body{background:#050505;color:#fff;display:flex;justify-content:center;padding:40px 12px; transition: 0.5s;}

.bg{
position:fixed;inset:0;
background-size:cover;
background-position:center;
filter:blur(60px) brightness(.4);
transform:scale(1.2);
transition:1.5s cubic-bezier(0.2, 0.8, 0.2, 1);
z-index:-1;
}

.bg.playing{
transform:scale(1.4);
filter:blur(50px) brightness(.6);
}

.app{
width:520px;max-width:100%;
border-radius:32px;
overflow:visible; /* Чтобы карточки могли вылезать за пределы */
background:rgba(255,255,255,.03);
backdrop-filter:blur(40px) saturate(180%);
-webkit-backdrop-filter:blur(40px) saturate(180%);
border:1px solid rgba(255,255,255,0.08);
box-shadow:0 30px 100px rgba(0,0,0,0.8);
}

.hero{
height:260px;
background-size:cover;
background-position:center;
display:flex;
align-items:flex-end;
padding:24px;
position:relative;
border-radius:32px 32px 0 0;
overflow:hidden;
}

.hero:after{
content:"";
position:absolute;
inset:0;
background:linear-gradient(to top, rgba(5,5,5,0.9), transparent);
}

.hero-text{position:relative;z-index:2}
.hero h1{font-size:28px; letter-spacing: -0.5px}
.hero p{opacity:.7; margin-top:4px; font-size: 15px}

.social{
display:flex; gap:10px; overflow-x:auto; padding:16px 20px;
scrollbar-width: none;
}
.social::-webkit-scrollbar { display: none; }

.social a{
white-space:nowrap; padding:10px 18px; border-radius:16px;
background:rgba(255,255,255,.06);
border: 1px solid rgba(255,255,255,0.05);
text-decoration:none; color:#fff; font-size: 13px; font-weight: 500;
transition: 0.3s;
}
.social a:hover { background:rgba(255,255,255,.12); transform: translateY(-2px); }

.beats{padding:10px 16px 30px; display:flex; flex-direction:column; gap:16px}

/* ЭФФЕКТ РАЗМЫТИЯ ОСТАЛЬНЫХ БИТОВ ПРИ НАВЕДЕНИИ */
.beats:hover .beat:not(:hover) {
    filter: blur(4px);
    opacity: 0.5;
    transform: scale(0.98);
}

.beat{
padding:20px;
border-radius:24px;
background: rgba(255,255,255, 0.04);
border: 1px solid rgba(255,255,255, 0.05);
transition: all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);
position:relative;
cursor: pointer;
}

/* АНИМАЦИЯ "ВЫЛЕТА" НА ТЕБЯ */
.beat:hover {
    background: rgba(255,255,255, 0.08);
    transform: scale(1.04) translateY(-5px);
    box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    border: 1px solid rgba(255,255,255, 0.15);
    z-index: 10;
}

.beat::before{
content:"";
position:absolute;
inset:0;
background:linear-gradient(120deg,transparent 20%,rgba(255,255,255,.1),transparent 80%);
opacity:0;
transition:.4s;
pointer-events:none;
}
.beat:hover::before{opacity:1}

.title{font-weight:700; font-size: 18px; display:flex; flex-wrap:wrap; gap:8px; align-items: center;}
.meta{font-size:12px; color:#ff6b6b; font-weight: 400; background: rgba(255,107,107,0.1); padding: 2px 8px; border-radius: 8px;}
.artist{font-size:14px; opacity:.5; margin-top:4px}

.player{display:flex; align-items:center; gap:12px; margin-top:16px}

.play{
width:42px; height:42px; border-radius:50%;
border:none; background:#fff; color:#000;
cursor:pointer; font-size: 12px;
display: flex; align-items: center; justify-content: center;
transition: 0.3s;
}
.play:hover { transform: scale(1.1); }

.progress{flex:1; height:6px; background:rgba(255,255,255,0.1); border-radius:10px; cursor:pointer; position: relative; overflow: hidden;}
.bar{height:100%; width:0%; background:#fff; border-radius:10px; transition: width 0.1s linear}

.bottom{display:flex; justify-content:space-between; align-items: center; margin-top:20px; gap:10px}
.price{font-size:11px; font-weight: 700; opacity:.9; letter-spacing: 0.5px}

.actions{display:flex; gap:10px}

.download, .buy{
border:none; padding:10px 18px; border-radius:14px; color:#fff; cursor:pointer; font-size: 12px; font-weight: 600; transition: 0.3s;
}

.download{background:rgba(255,255,255,.08); border: 1px solid rgba(255,255,255,0.05)}
.buy{background:#fff; color:#000}

.download:hover { background: rgba(255,255,255,0.15); }
.buy:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255,255,255,0.3); }

.footer{text-align:center; padding:30px; font-size:11px; opacity:.4; letter-spacing: 1px}
.footer a{color:#fff; text-decoration:none; font-weight: 700;}
</style>
</head>

<body>

<div class="bg" id="bg"></div>

<div class="app">
<div class="hero" id="hero">
<div class="hero-text">
<h1 id="name">Loading...</h1>
<p id="desc"></p>
</div>
</div>

<div class="social" id="social"></div>
<div class="beats" id="beats"></div>

<div class="footer">
© <a href="https://t.me/imbulavin" target="_blank">BULAVIN SYSTEM</a>
</div>
</div>

<script>
const CSV_URL="https://docs.google.com/spreadsheets/d/e/2PACX-1vRaW-Jeexk1nvmxlUTk7TAq2akhZW8eY7OxYkgbNcDFyfcOqfyq17_L4w3xRW8cz14JWME0_Fk29hWs/pub?output=csv";

let currentAudio=null;
let currentBtn=null;

function parseCSV(text) {
    const result = [];
    let row = [];
    let cell = "";
    let insideQuotes = false;
    text = text.replace(/^\uFEFF/, '').replace(/\r\n/g, '\n').replace(/\r/g, '\n');
    for (let i = 0; i < text.length; i++) {
        let char = text[i];
        if (char === '"' && text[i+1] === '"') { cell += '"'; i++; }
        else if (char === '"') { insideQuotes = !insideQuotes; }
        else if (char === ',' && !insideQuotes) { row.push(cell.trim()); cell = ""; }
        else if (char === '\n' && !insideQuotes) { row.push(cell.trim()); result.push(row); row = []; cell = ""; }
        else { cell += char; }
    }
    if (cell || row.length) { row.push(cell.trim()); result.push(row); }
    return result;
}

fetch(CSV_URL)
.then(r=>r.text())
.then(text=>{
    const rows = parseCSV(text);
    const p = rows[1] || [];

    document.getElementById('name').textContent = p[0] || "Artist";
    document.getElementById('desc').textContent = p[1] || "";
    
    if(p[2]) {
        document.getElementById('hero').style.backgroundImage = `url('${p[2]}')`;
        document.getElementById('bg').style.backgroundImage = `url('${p[2]}')`;
    }

    const socialContainer = document.getElementById('social');
    [["TG", p[3]], ["INST", p[4]], ["YT", p[5]], ["VK", p[6]]].forEach(s => {
        if (s[1] && s[1].includes('http')) {
            const a = document.createElement("a");
            a.href = s[1]; a.target = "_blank"; a.textContent = s[0];
            socialContainer.appendChild(a);
        }
    });

    const buyLink = p[7] || "#";

    rows.slice(4).forEach(r => {
        if (!r[0]) return;

        const beat = document.createElement("div");
        beat.className = "beat";
        beat.innerHTML = `
            <div class="title">${r[0]} <span class="meta">${r[2] || '0'} BPM</span></div>
            <div class="artist">${r[1] || ""}</div>
            <div class="player">
                <button class="play">▶</button>
                <div class="progress"><div class="bar"></div></div>
            </div>
            <div class="bottom">
                <div class="price">MP3 ${r[4]} | WAV ${r[5]} | EXCL ${r[6]}</div>
                <div class="actions">
                    <button class="download">MP3</button>
                    <button class="buy">КУПИТЬ</button>
                </div>
            </div>
        `;

        const audio = new Audio(r[7]);
        const playBtn = beat.querySelector(".play");
        const bar = beat.querySelector(".bar");
        const progress = beat.querySelector(".progress");

        playBtn.onclick = (e) => {
            e.stopPropagation();
            if (currentAudio && currentAudio !== audio) {
                currentAudio.pause();
                currentBtn.textContent = "▶";
            }
            if (audio.paused) {
                audio.play();
                playBtn.textContent = "II";
                currentAudio = audio;
                currentBtn = playBtn;
                document.getElementById('bg').classList.add("playing");
            } else {
                audio.pause();
                playBtn.textContent = "▶";
                document.getElementById('bg').classList.remove("playing");
            }
        };

        audio.ontimeupdate = () => {
            bar.style.width = (audio.currentTime / audio.duration * 100) + "%";
        };

        audio.onended = () => {
            playBtn.textContent = "▶";
            document.getElementById('bg').classList.remove("playing");
        };

        progress.onclick = e => {
            e.stopPropagation();
            const rect = progress.getBoundingClientRect();
            audio.currentTime = ((e.clientX - rect.left) / rect.width) * audio.duration;
        };

        beat.querySelector(".buy").onclick = (e) => { e.stopPropagation(); window.open(buyLink, "_blank"); };
        beat.querySelector(".download").onclick = (e) => { e.stopPropagation(); window.open(r[7], "_blank"); };

        document.getElementById('beats').appendChild(beat);
    });
});
</script>

</body>
</html>
